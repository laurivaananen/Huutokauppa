{% extends 'layout.html' %}

{% block body %}

<!-- Add to account balance if you are the account owner -->
<!-- {% if current_user.id == account_information.id %}
<form class="account-deposit" method="POST" action="{{ url_for('account_deposit') }}">
    <table>
        <tr>
            <th><h2>Deposit money to your account</h2></th>
            <td></td>
        </tr>
        <tr>
            <td>
                {{ form.amount }}
            </td>
            <td>
                {% if form.amount.errors %}
                <ul>
                    
                    {% for error in form.amount.errors %}
                    <li class="form-error">{{ error }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>
                <input class="btn btn-green" type="submit" value="Deposit"/>
            </td>
        </tr>
    </table>
</form>
{% endif %} -->



<!-- User account details -->
<table class="user-detail detail-table">
    <tr>
        <th>Username</th>
        <td>{{ account_information.user_account.user_name }}</td>
    </tr>
    <tr>
        <th>Email</th>
        <td>{{ account_information.email_address }}</td>
    </tr>
    {% if current_user.id == account_information.id %}
    <tr>
        <th>Phone number</th>
        <td>{{ account_information.phone_number }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>Items on sale</th>
        <td>{{ account_information.items_count(account_information.id) }}</td>
    </tr>
    <tr>
        <th>Bids</th>
        <td>{{ account_information.bids_count(account_information.id) }}</td>
    </tr>
    {% if current_user.id == account_information.id %}
    <tr>
        <th>Account Balance</th>
        <td>{{ account_information.account_balance }}</td>
    </tr>
    <tr>
        <th colspan="2" class="info-text">Billing information</th>
    </tr>
    <tr>
        <th>Country</th>
        <td>{{ account_information.country.name }}</td>
    </tr>
    <tr>
        <th>City</th>
        <td>{{ account_information.city.name }}</td>
    </tr>
    <tr>
        <th>Postal code</th>
        <td>{{ account_information.postal_code.name }}</td>
    </tr>
    <tr>
        <th>Address</th>
        <td>{{ account_information.street_address.name }}</td>
    </tr>
    {% endif %}
</table>

{% if current_user.id == account_information.id%}
    {% if items %}
        <table class="user-items detail-table">
            
            <tr>
                <th>Item name</th>
                <th>Starting price</th>
                <th>Latest bid</th>
                <th>Bidding end</th>
                <th>Buyer</th>
            </tr>
            {% for item in items %}
            <tr>
                <td>
                    <a class="important" href="{{ url_for('item_detail', item_id=item.id) }}">{{ item.name }}</a>
                </td>
                <td>{{ item.starting_price }}</td>

                {% if item.latest_bid() %}
                    <td>{{ item.latest_bid() }}</td>
                {% else %}
                    <td class="info-text">No bids yet</td>
                {% endif %}

                {% if item.sold %}
                    <td class="info-text">Sold</td>
                {% elif item.hidden %}
                    <td class="info-text">Bidding time over</td>
                {% else %}

                {% if item.bidding_time_left().hours > 23 %}
                    <td>{{ item.datetime_from_utc() }}</td>
                {% else %}
                    {% from 'items/time_left_macro.html' import time_left_macro %}
                    <td>{{ time_left_macro(item.bidding_time_left()) }}</td>
                {% endif %}
                {% endif %}

                {% if item.sold %}
                    <td><a href="{{ url_for('user_detail', user_id=item.buyer_account_information_id) }}">{{ item.buyer_account_information.user_account.user_name }}</a></td>
                {% else %}
                    <td>-</td>
                {% endif %}

            </tr>
            {% endfor %}
        </table>
        {% else %}
            <p class="info-text">You have no items on sale</p>
        {% endif %}
{% endif %}

{% if current_user.id == account_information.id%}
    {% if bought_items %}
    <table class="user-bought-items detail-table">

        <tr>
            <th>Item name</th>
            <th>Starting Price</th>
            <th>You paid</th>
            <th>Sold at</th>
        </tr>
        {% for item_bought in bought_items %}
        <tr>
            <td>
                <a class="important" href="{{ url_for('item_detail', item_id=item_bought.id) }}">{{ item_bought.name }}</a>
            </td>
            <td>{{ item_bought.starting_price }}</td>
            <td>{{ item_bought.latest_bid() }}</td>
            <td>{{ item_bought.datetime_from_utc() }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
        <p class="info-text">You haven't bought any items yet</p>
    {% endif %}
{% endif %}

{% endblock %}